---
- name: Bootstrap development environment
  hosts: cosmos
  connection: local
    
  vars:
    ansible_password: '{{ lookup("env", "ANSIBLE_PASSWORD") }}'

  tasks:
    - name: Prompt SSH password if necessary
      when: ansible_password is undefined
      block:
        - name: Conditionally prompt for ssh/sudo password
          no_log: true
          register: password_prompt
          ansible.builtin.pause:
            prompt: "Password for {{ ansible_user_id }}@{{ ansible_host }}"
            echo: false

        - name: Set ansible_password
          no_log: true
          ansible.builtin.set_fact:
            ansible_password: "{{ password_prompt.user_input }}"

    - name: Set ansible_become_password
      no_log: true
      when: ansible_become_password is undefined
      ansible.builtin.set_fact:
        ansible_become_password: "{{ ansible_password }}"

    - ansible.builtin.import_tasks:
        file: tasks/bootstrap.yml

    - name: Bootstrap System
      tags: system
      import_role:
        name: system